<% map = @map %>

<tr>
  <% cl = cycle('table0', 'table1') %>
  <td class="<%= cl %>">
    <%=  image_tag(map_thumb_url(map)) %>
  </td>
  <td class="<%= cl %>">
    <span class="maplist_title">
      <%=strip_brackets(URI.unescape(map.title)) %>
    </span>

    <br />
    <span class="map_description">
      <%=snip_word(strip_brackets(map.description),80) -%>
    </span>
    <span class="map_summary">
      <%- if map.owner -%>Uploaded by <%= link_to(map.owner.login, user_path(map.owner)) -%>.<%-end-%>
      <%- if map.layers.count > 0 -%>
        (In <%=link_to(pluralize(map.layers.count, 'mosaic'), map_layers_path(map.id)) -%>)
      <%-  end -%>
      <span class="map_year">
        <% if map.depicts_year -%>
          Depicts: <%= map.depicts_year -%>
        <% end -%>
      </span>
      <% if !map.public? %><span class="publicprivate">(Not listed)</span><% end-%>
      Last modified <%=h time_ago_in_words(map.last_changed) -%> ago.
      <%if map.gcps.hard.size > 0 %>
        <%=pluralize(map.gcps.hard.size, "control point") -%>.
      <%else-%>
        Unrectified.
      <%end-%>
    </span>
    <br />
    <% if map.tags.count > 0 -%>
      <span class="map_summary">Tags:</span>
      <span class="tags">
        <% map.tags.each do | tag | -%>
          <%= link_to tag.name, { :controller=> :maps, :action => :tag, :id => tag.name } %>
        <% end %>
      </span>
      <br />
    <% end -%>

    <span class="map_links">
      

      <%- if map.source_uri -%>
        Links: <%=  sanitize(link_to(image_tag("commons_logo-25x25.png", :height => '16')+" Wikimedia Commons",  map.source_uri), attributes: %w(href src height img)) %>
      <%- end -%>
      <% if !admin_authorized? && map.published? %>
        | <strong>Published [<a href="#" title="This map has been published by an admin and no further editing is possible.">?</a>]</strong>
      <% end %>
      <% if admin_authorized? %>
        <% if map.status == :warped  %>
          | <%= link_to("Publish",publish_map_path(:id => map, :to => "publish"), :confirm => "Really publish this map? This will mean that no further editing can be done") -%>
        <% elsif map.published? %>
          | <%= link_to("UnPublish",publish_map_path(:id => map, :to => "unpublish"), :confirm => "Really un publish this map? This will mean that the map can be edited now") -%>
        <% end %>
      <% end -%>
          
      <%= render :partial => 'shared/export_window', :locals => {:map => @map} %>
    </span>
  </td>
</tr>
